<div class="main">
    <div class="row">
        <div class="col">



            <mat-card>
                <mat-card-title class="card-title">Add User</mat-card-title>
                <mat-card-content class="mt-4">
                    <!-- Spinner -->
                    <mat-spinner *ngIf="isLoading"></mat-spinner>
                    
                    <!-- Form -->
                    <form [formGroup]="form" (submit)="onAddUser()" *ngIf="!isLoading">
                        
                        <!-- First_name -->
                        <mat-form-field appearance="outline" class="mb-4">
                            <mat-label>First name</mat-label>
                            <input matInput
                                type="text" 
                                name="first_name"
                                formControlName="first_name"
                                >
                            <mat-error
                                *ngIf="form.get('first_name')?.invalid && form.get('first_name')?.touched">
                                Please enter a valid name.
                            </mat-error>

                        </mat-form-field>
                        
                        
                        <!-- Last name -->
                        <mat-form-field appearance="outline" class="mb-4">
                            <mat-label>Last name</mat-label>
                            <input matInput
                                type="text" 
                                name="last_name"
                                formControlName="last_name"
                                >
                            <mat-error
                                *ngIf="form.get('last_name')?.invalid && form.get('last_name')?.touched">
                                Please enter a valid name.
                            </mat-error>

                        </mat-form-field>
                        
                        
                        <!-- Institution -->
                        <mat-form-field appearance="outline" class="mb-4">
                            <mat-label>Institution</mat-label>
                            <input matInput
                                type="text" 
                                name="institution"
                                formControlName="institution"
                                >
                            <mat-error
                                *ngIf="form.get('institution')?.invalid && form.get('institution')?.touched">
                                Please enter a valid institution.
                            </mat-error>

                        </mat-form-field>
                        
                        
                        <!-- Role -->
                        <mat-form-field appearance="outline" class="mb-4">
                            <mat-label>Role</mat-label>
                            <mat-select 
                                formControlName="role" 
                                name="role">
                                <mat-option value="admin">Admin</mat-option>
                                <mat-option value="researcher">Researcher</mat-option>
                            </mat-select>

                            <mat-error *ngIf="form.get('role')?.invalid && form.get('role')?.touched">
                                Please select a role.
                            </mat-error>
                        </mat-form-field>



                        <!-- Email -->
                        <mat-form-field appearance="outline" class="mb-4">
                            <mat-label>Email</mat-label>
                            <input matInput
                                type="text" 
                                name="email"
                                formControlName="email"
                                >
                            
                            <mat-error
                                *ngIf="(form.get('email')?.invalid && form.get('email')?.touched)">
                                Please enter a valid email.
                            </mat-error>

                             <!-- Error del backend (Prioritario) -->
                            <mat-error *ngIf="form.get('email')?.hasError('backendError')">
                                {{ errors }}
                            </mat-error>
                        </mat-form-field>  



                        <!-- Password -->
                        <mat-form-field appearance="outline" class="mb-4">
                            <mat-label><i class="fas fa-lock me-2"></i> Password</mat-label>
                            <input matInput
                                [type]="hidePassword ? 'password' : 'text'"
                                type="password"
                                name="password"
                                formControlName="password">

                            <button mat-icon-button
                                    type="button"
                                    matSuffix
                                    (click)="hidePassword = !hidePassword"
                                    [attr.aria-label]="'Toggle password visibility'"
                                    [attr.aria-pressed]="!hidePassword">
                                <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>

                            </button>
                            

                            <mat-error
                                *ngIf="form.get('password')?.invalid && form.get('password')?.touched">
                                Please enter a valid password.
                            </mat-error>
                        </mat-form-field>


                        <!-- Button Save Post -->
                        <div class="mt-3">
                            <button 
                                type="submit" 
                                mat-raised-button 
                                color="primary"
                                
                                >Add User</button>
                                <!-- [disabled]="!form.valid" -->
                        </div>
                        
                        
                    </form>

                </mat-card-content>
                
            </mat-card>





        </div>
    </div>
</div>

<!-- MODAL -->
<dialog id="modal">

    <h2>Error</h2>
    <div *ngIf="errors?.length" class="alert alert-danger mt-3 p-3 rounded" role="alert">
        <ul class="mb-0">
            <li *ngFor="let err of errors">
                 {{ err }}
            </li>
        </ul>
    </div>

    <div class="actions">
        <button class="cancel-btn" onclick="document.getElementById('modal').close()">Cerrar</button>
    </div>

</dialog>
