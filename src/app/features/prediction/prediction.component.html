<!-- TITULO -->
<div class="col-sm-12 col-md-6">
  <h3 class="text-primary text-start mb-4 fw-semibold">Prediction of Algae</h3>
</div>

<!-- Seccion Panel prediccion-->
<div>
  <div class="mt-4"><!-- titulo-->
          <h2 class="h5 text-muted fw-semibold mb-3">
              <i class="fas fa-cogs fa-sm text-secondary me-2"></i> Data Prediction
          </h2>
  </div>

  <!-- cuerpo-->
  <div class="card shadow p-4" style="width: 100%;">
    <!-- formulario-->
    <form [formGroup]="predictionForm" (ngSubmit)="runPrediction()">

      <div class="grid-container">
          <!-- Primera columna dividida en 2 filas -->
          <div class="left-column">
            <div class="sitio-section mb-3">
              <label class="form-label fw-semibold">Site</label>
              <div class="btn-group btn-group-toggle d-flex flex-wrap" role="group">
                <button
                  type="button"
                  *ngFor="let site of sites"
                  class="btn btn-outline-primary m-1"
                  [class.active]="predictionForm.get('site')?.value === site.name"
                  (click)="predictionForm.get('site')?.setValue(site.name)"
                >
                  {{ site.name }}
                </button>
              </div>
              <div *ngIf="isInvalid('site')" class="text-danger mt-1 small">Select a valid site.</div>
            </div>

            <div class="especie-section mb-3">
              <label class="form-label fw-semibold">Algae species</label><!-- style="max-height: 150px; overflow-y: auto;" -->
              <div class="btn-group btn-group-toggle d-flex flex-wrap" role="group">
                <button
                  type="button"
                  *ngFor="let algae of species"
                  class="btn btn-outline-success m-1"
                  [class.active]="predictionForm.get('specie')?.value === algae.name"
                  (click)="predictionForm.get('specie')?.setValue(algae.name)"
                >
                  {{ algae.name }}
                </button>
              </div>
              <div *ngIf="isInvalid('specie')" class="text-danger mt-1 small">Select a valid species.</div>
            </div>
          </div>

          <!-- Segunda columna con inputs -->
          <div class="right-column">
            <div class="mb-3">
              <label for="temperature" class="form-label fw-semibold">Temperature (°C)</label>
              <input
                type="number"
                class="form-control"
                id="temperature"
                formControlName="temperature"
                [ngClass]="{ 'is-invalid': isInvalid('temperature') }"
                min="0" max="50"
              />
              <div class="invalid-feedback">Temperature must be between 0 and 50 °C.</div>
            </div>

            <div class="mb-3">
              <label for="din" class="form-label fw-semibold">DIN (µmol/L)</label>
              <input
                type="number"
                class="form-control"
                id="din"
                formControlName="din"
                [ngClass]="{ 'is-invalid': isInvalid('din') }"
                min="0"
              />
              <div class="invalid-feedback">DIN must be a positive number.</div>
            </div>

            <div class="mb-3">
              <label for="nt" class="form-label fw-semibold">NT (µmol/L)</label>
              <input
                type="number"
                class="form-control"
                id="nt"
                formControlName="nt"
                [ngClass]="{ 'is-invalid': isInvalid('nt') }"
                min="0"
              />
              <div class="invalid-feedback">NT must be a positive number.</div>
            </div>

            <div class="mb-3">
              <label for="days" class="form-label fw-semibold">Predicted algae growth after X days.</label>
              <input
                type="number"
                class="form-control"
                id="days"
                formControlName="days"
                [ngClass]="{ 'is-invalid': isInvalid('days') }"
                min="1"
              />
              <div class="invalid-feedback">Enter a valid number of days (minimum 1).</div>
            </div>

            <button type="submit" class="btn btn-primary mt-3 w-100 fw-semibold">Predict</button>
          </div>
      </div>

      <div *ngIf="result" class="alert alert-info mt-4 text-center fw-semibold">
          {{ result }}
      </div>
    </form>
  </div>
</div>

<div><!--Seccion Resultado de prediccion-->
<!-- titulo-->  
  <div class="mt-4">
      
        <h2 class="h5 text-muted fw-semibold mb-3">
            <i class="fas fa-chart-line fa-sm text-secondary me-2"></i> Prediction Results
        </h2>
    </div>

  <div class="card border-0 shadow-sm"><!-- seccion card--> 
    <!-- Header con icono -->
    <div class="card-header bg-primary bg-opacity-10 py-3 border-bottom">
      <div class="d-flex justify-content-between align-items-center">
        <h5 class="card-title mb-0 text-primary">
          <i class="fas fa-clock-rotate-left me-2"></i>
        </h5>
        <span class="badge bg-primary"></span>
      </div>
    </div>

    <!-- Cuerpo -->
    <div class="card-body">
      
      <div class="row justify-content-center">
       
        <!-- Columna data -->
        <div class="col-md-4 d-flex flex-column justify-content-center">
          <div class="d-flex mb-3">
            <i class="fas fa-calendar-day text-primary mt-1 me-3"></i>
            <div>
              <h6 class="mb-0 text-muted">Fecha y hora de predicción</h6>
              <p class="mb-0 fw-bold">
                {{ predictedData?.date ? (predictedData?.date | date:'dd MMM yyyy - HH:mm:ss') : 'Not defined' }}
              </p>
            </div>
          </div>

          <div class="d-flex mb-3">
            <i class="fas fa-map-marker-alt text-primary mt-1 me-3"></i>
            <div>
              <h6 class="mb-0 text-muted">Site</h6>
              <p class="mb-0 fw-bold">{{ predictedData?.site ?? 'Not select' }}</p>
            </div>
          </div>

          <div class="d-flex mb-3">
            <i class="fas fa-seedling text-primary mt-1 me-3"></i>
            <div>
              <h6 class="mb-0 text-muted">Algae</h6>
              <p class="mb-0 fw-bold">{{ predictedData?.specie ?? 'Not select' }}</p>
            </div>
          </div>
        </div>

        <!-- Columna result Biomass-->
        <div class="col-md-4 d-flex flex-column align-items-center justify-content-center responsive-border">
          <h6 class="text-muted mb-1"><i class="fas fa-bacteria me-2"></i>Biomass</h6>
          <span class="badge bg-success text-white fs-4 px-4 py-2">
            {{ predictedData?.growth ?? '0' }} units
          </span>
          <!-- Canvas del gráfico -->
          <div *ngIf="predictedData" style="width: 100%; height: 180px; padding-top: 1rem;">
            <canvas id="biomassChart"></canvas>
          </div>
        </div>

        <!-- Columna parameters -->
        <div class="col-md-4 text-center d-flex flex-column justify-content-center" style="padding: 1rem;">
        <div class="row justify-content-center">
          <div class="col-6 mb-3 d-flex flex-column align-items-center">
            <h6 class="text-muted mb-1"><i class="fas fa-temperature-high me-2"></i>Temperature</h6>
            <span class="badge bg-info text-white fs-6">
              {{ predictedData?.temperature ?? '0.0' }} °C
            </span>
          </div>
          <div class="col-6 mb-3 d-flex flex-column align-items-center">
            <h6 class="text-muted mb-1"><i class="fas fa-water me-2"></i>DIN</h6>
            <span class="badge bg-danger text-white fs-6">
              {{ predictedData?.din ?? '0.0' }} mg/L
            </span>
          </div>
          <div class="col-6 mb-3 d-flex flex-column align-items-center">
            <h6 class="text-muted mb-1"><i class="fas fa-flask me-2"></i>NT</h6>
            <span class="badge bg-warning text-white fs-6">
              {{ predictedData?.nt ?? '0.0' }} mg/L
            </span>
          </div>
          <div class="col-6 mb-3 d-flex flex-column align-items-center">
            <h6 class="text-muted mb-1"><i class="fas fa-clock me-2"></i>Days after</h6>
            <span class="badge bg-secondary text-white fs-6">
              {{ predictedData?.days ?? '0' }} days
            </span>
          </div>
        </div>
        </div>

      </div>

    </div>

  </div>

</div>

